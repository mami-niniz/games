<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>í˜¸ë‘ì´ ì„ ìƒë‹˜ì˜ O/X í€´ì¦ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }

        body { 
            font-family: 'Jua', sans-serif; 
            background-color: #ffcc80; /* í˜¸ë‘ì´ ë°°ê²½ìƒ‰ */
            background-image: radial-gradient(#ff9800 15%, transparent 16%), radial-gradient(#ff9800 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            color: #3e2723;
            text-align: center; 
            margin: 0; 
            padding: 0; 
            min-height: 100dvh; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-box { 
            background: #fff3e0; 
            border-radius: 25px; 
            padding: 30px; 
            max-width: 800px; 
            width: 95%;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 #5d4037; 
            border: 5px solid #ff6f00;
        }
        .hidden { display: none !important; }

        /* ì¸íŠ¸ë¡œ */
        .intro-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .char-img {
            width: 160px;
            height: 160px;
            object-fit: cover;
            border-radius: 50%;
            border: 6px solid #ff6f00;
            background: #fff;
            box-shadow: 0 0 20px rgba(255, 111, 0, 0.4);
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 { 
            font-size: 48px; 
            color: #e65100; 
            margin: 0;
            text-shadow: 2px 2px 0 #fff;
            line-height: 1.2;
        }
        
        .desc-text { font-size: 22px; color: #795548; margin-top: 5px; }

        /* ì…ë ¥ì°½ ë° ë²„íŠ¼ */
        input[type="text"] { 
            padding: 12px; 
            font-size: 22px; 
            border-radius: 15px; 
            border: 3px solid #ff6f00; 
            width: 70%; 
            font-family: 'Jua', sans-serif; 
            text-align: center; 
            margin-bottom: 20px; 
            background: #fff; 
        }
        
        .btn { padding: 10px 15px; margin: 5px; font-size: 20px; cursor: pointer; border: none; border-radius: 12px; font-family: 'Jua', sans-serif; transition: 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        .lvl-btn { background: #ffe0b2; color: #e65100; }
        .lvl-btn.active { background: #ff6f00; color: white; border: 2px solid #bf360c;}
        
        .start-btn { 
            background: #d84315; 
            color: white; 
            font-size: 32px; 
            padding: 15px 50px; 
            margin-top: 20px; 
            width: 80%; 
            border-radius: 50px;
            border-bottom: 6px solid #bf360c;
        }

        /* â˜… ê²Œì„ í™”ë©´ */
        #game-screen {
            width: 100%;
            max-width: 600px;
            display: none;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
        }

        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            font-size: 24px;
            color: #3e2723;
            font-weight: bold;
        }

        /* íƒ€ì´ë¨¸ ë°” */
        .timer-container {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid #3e2723;
        }
        .timer-bar {
            width: 100%;
            height: 100%;
            background: #d84315;
            transition: width 0.1s linear;
        }

        .quiz-card {
            background: #fff;
            border-radius: 20px;
            padding: 40px 20px;
            width: 95%;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 4px solid #8d6e63;
            position: relative;
            margin-bottom: 30px;
        }

        .tiger-avatar {
            position: absolute;
            top: -60px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid #ff6f00;
            background: #fff;
            object-fit: cover;
        }

        .word-text {
            font-size: 48px;
            color: #d84315;
            margin-bottom: 10px;
            margin-top: 30px;
        }

        .mean-text {
            font-size: 28px;
            color: #333;
            word-break: keep-all;
            line-height: 1.4;
        }

        /* OX ë²„íŠ¼ */
        .ox-btn-container {
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: center;
        }

        .ox-btn {
            width: 45%;
            aspect-ratio: 1; /* ì •ì‚¬ê°í˜• ìœ ì§€ */
            max-width: 150px;
            border-radius: 20px;
            font-size: 80px;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s;
            font-family: 'Jua', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ox-btn:active { transform: translateY(6px); box-shadow: none; }

        .btn-o { background: #42a5f5; color: white; border-bottom: 8px solid #1565c0; text-shadow: 2px 2px 0 #0d47a1; }
        .btn-x { background: #ef5350; color: white; border-bottom: 8px solid #c62828; text-shadow: 2px 2px 0 #b71c1c; }

        /* ê²°ê³¼ í‘œì‹œ (ì •ë‹µ/ì˜¤ë‹µ) */
        .feedback-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            align-items: center; justify-content: center;
            font-size: 150px;
            font-weight: bold;
            z-index: 50;
            background: rgba(255,255,255,0.8);
            border-radius: 20px;
            display: none; /* JSë¡œ ì œì–´ */
        }

        .rank-table { width: 100%; margin-top: 20px; border-collapse: separate; border-spacing: 0 5px; font-size: 18px; }
        .rank-table th { background: #5d4037; color: #fff; padding: 10px; border-radius: 10px 10px 0 0; }
        .rank-table td { background: #8d6e63; color: white; padding: 10px; border-bottom: 1px solid #5d4037; }
        .rank-table tr:last-child td:first-child { border-bottom-left-radius: 10px; }
        .rank-table tr:last-child td:last-child { border-bottom-right-radius: 10px; }
        .rank-1 { color: #ffd54f !important; font-size: 1.2em; text-shadow: 1px 1px 0 #3e2723;}

        @media (max-width: 600px) {
            h1 { font-size: 36px; }
            .char-img { width: 130px; height: 130px; }
            .tiger-avatar { width: 100px; height: 100px; top: -50px; }
            .word-text { font-size: 36px; }
            .mean-text { font-size: 22px; }
            .ox-btn { font-size: 60px; max-width: 120px; }
        }
    </style>
</head>
<body>

    <div id="intro-screen" class="game-box">
        <div class="intro-header">
            <img src="tiger.png" alt="í˜¸ë‘ì´ ì„ ìƒë‹˜" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Tiger%20Face.png'">
            <div>
                <h1>í˜¸ë‘ì´ ì„ ìƒë‹˜ì˜<br>O/X í€´ì¦ˆ</h1>
                <p class="desc-text">ë§ìœ¼ë©´ O, í‹€ë¦¬ë©´ X!</p>
            </div>
        </div>

        <input type="text" id="username" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="8">

        <div style="margin: 20px 0;">
            <p style="margin-bottom:5px;">ğŸ“š í•™ë…„ ì„ íƒ</p>
            <button class="btn lvl-btn active" onclick="selectLevel('1-2', this)">1-2í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('3-4', this)">3-4í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('5-6', this)">5-6í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('ì¤‘1', this)">ì¤‘1</button>
        </div>

        <button class="btn start-btn" onclick="startGame()">í€´ì¦ˆ ì‹œì‘ â–¶</button>

        <div style="margin-top: 30px;">
            <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (ì ìˆ˜)</h3>
            <table class="rank-table" id="ranking-table"><tr><td colspan="4">ë¡œë”©ì¤‘...</td></tr></table>
        </div>
    </div>

    <div id="game-screen">
        <div class="top-bar">
            <span>ğŸ¯ <span id="progress-display">1 / 10</span></span>
            <span>ğŸ’¯ <span id="score-display">0</span>ì </span>
        </div>

        <div class="timer-container">
            <div id="timer-bar" class="timer-bar"></div>
        </div>

        <div class="quiz-card">
            <img src="tiger.png" class="tiger-avatar" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Tiger%20Face.png'">
            
            <div class="word-text" id="quiz-word">ë‹¨ì–´</div>
            <div style="color:#795548; font-size:20px; margin-bottom:10px;">(ì€)ëŠ”</div>
            <div class="mean-text" id="quiz-mean">ëœ» ì„¤ëª…ì´ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤.</div>

            <div id="feedback" class="feedback-overlay"></div>
        </div>

        <div class="ox-btn-container">
            <button class="ox-btn btn-o" onclick="checkAnswer(true)">O</button>
            <button class="ox-btn btn-x" onclick="checkAnswer(false)">X</button>
        </div>
        
        <div style="margin-top:20px;">
            <button class="btn" style="background:#8d6e63; color:white; font-size:16px;" onclick="goHome()">ğŸ  ê·¸ë§Œí•˜ê¸°</button>
        </div>
    </div>

    <div id="result-screen" class="game-box hidden">
        <img src="tiger.png" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Tiger%20Face.png'">
        <h1 style="color:#e65100; margin-top:20px;">í€´ì¦ˆ ì¢…ë£Œ!</h1>
        <h2 id="final-score" style="color: #3e2723; font-size: 40px; margin: 15px 0;">0ì </h2>
        <p id="final-msg" style="font-size: 22px; color:#555;">í˜¸ë‘ì´ ì„ ìƒë‹˜ì´ ì±„ì  ì¤‘ì…ë‹ˆë‹¤...</p>
        <button class="btn start-btn" onclick="location.reload()">ğŸ”„ ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>

    <script src="../kovocab/my_word_data.js"></script> 

    <script>
        if (typeof wordData === 'undefined') {
            alert("ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! (../kovocab/my_word_data.js í™•ì¸)");
            var wordData = { "1-2": [{word:"ì‚¬ê³¼",mean:"ê³¼ì¼"},{word:"ë°”ë‚˜ë‚˜",mean:"ë…¸ë€ ê³¼ì¼"}] };
        }

        let currentLevel = "1-2";
        let maxQuestions = 10; // ë¬¸ì œ ìˆ˜
        let timePerQuestion = 10; // ë¬¸ì œë‹¹ ì‹œê°„(ì´ˆ)
        
        let userName = "";
        let quizList = [];
        let currentIndex = 0;
        let score = 0;
        let combo = 0;
        
        let timerInterval;
        let timeLeft;
        let isAnswering = false; // ì¤‘ë³µ í´ë¦­ ë°©ì§€

        window.onload = loadRanking;

        function selectLevel(lvl, btn) {
            currentLevel = lvl;
            document.querySelectorAll('.lvl-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function startGame() {
            const inputName = document.getElementById('username').value.trim();
            if (!inputName) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            userName = inputName;

            const pool = wordData[currentLevel];
            if (!pool || pool.length < 5) {
                alert(`ë‹¨ì–´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ìµœì†Œ 5ê°œ í•„ìš”)`); return;
            }

            // ë¬¸ì œ ìƒì„± (O/X ì„ì–´ì„œ)
            generateQuizList(pool);
            
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').style.display = 'flex';

            currentIndex = 0;
            score = 0;
            combo = 0;
            showQuestion();
        }

        function generateQuizList(pool) {
            quizList = [];
            let usedIndices = new Set();
            
            // ë°ì´í„° í’€ì—ì„œ ëœë¤í•˜ê²Œ ì„ íƒ
            let safePool = [...pool]; 
            
            for(let i=0; i<maxQuestions; i++) {
                if(safePool.length === 0) safePool = [...pool]; // ëª¨ìë¥´ë©´ ë¦¬í•„
                
                const randIdx = Math.floor(Math.random() * safePool.length);
                const target = safePool[randIdx];
                
                // 50% í™•ë¥ ë¡œ ì •ë‹µ(O), 50% í™•ë¥ ë¡œ ì˜¤ë‹µ(X) ìƒì„±
                const isCorrect = Math.random() < 0.5;
                let questionMean = target.mean;
                
                if (!isCorrect) {
                    // ì˜¤ë‹µì¼ ê²½ìš° ë‹¤ë¥¸ ë‹¨ì–´ì˜ ëœ»ì„ ê°€ì ¸ì˜´
                    let wrongIdx;
                    do {
                        wrongIdx = Math.floor(Math.random() * pool.length);
                    } while (pool[wrongIdx].word === target.word && pool.length > 1);
                    questionMean = pool[wrongIdx].mean;
                }

                quizList.push({
                    word: target.word,
                    mean: questionMean,
                    answer: isCorrect // true(O) or false(X)
                });
            }
        }

        function showQuestion() {
            if (currentIndex >= maxQuestions) {
                endGame();
                return;
            }

            // í™”ë©´ ê°±ì‹ 
            document.getElementById('progress-display').innerText = `${currentIndex + 1} / ${maxQuestions}`;
            document.getElementById('score-display').innerText = score;
            document.getElementById('feedback').style.display = 'none'; // í”¼ë“œë°± ìˆ¨ê¹€
            
            const q = quizList[currentIndex];
            document.getElementById('quiz-word').innerText = q.word;
            document.getElementById('quiz-mean').innerText = q.mean;

            // íƒ€ì´ë¨¸ ì‹œì‘
            startTimer();
            isAnswering = false;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = timePerQuestion;
            updateTimerBar();
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                updateTimerBar();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeOut();
                }
            }, 100);
        }

        function updateTimerBar() {
            const bar = document.getElementById('timer-bar');
            const percent = (timeLeft / timePerQuestion) * 100;
            bar.style.width = `${percent}%`;
            
            // ìƒ‰ìƒ ë³€ê²½ (ì‹œê°„ ì–¼ë§ˆ ì•ˆ ë‚¨ì•˜ì„ ë•Œ)
            if(percent < 30) bar.style.background = '#d32f2f'; // ë¹¨ê°•
            else bar.style.background = '#d84315'; // ì£¼í™©
        }

        function checkAnswer(userChoice) {
            if (isAnswering) return;
            isAnswering = true;
            clearInterval(timerInterval);

            const q = quizList[currentIndex];
            const isCorrect = (userChoice === q.answer);
            
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'flex';

            if (isCorrect) {
                // ì •ë‹µ
                feedback.innerText = "â­•";
                feedback.style.color = "#2e7d32";
                score += 10 + combo; // ì½¤ë³´ ë³´ë„ˆìŠ¤
                combo++;
                // 1ì´ˆ ë’¤ ë‹¤ìŒ ë¬¸ì œ
                setTimeout(() => {
                    currentIndex++;
                    showQuestion();
                }, 800);
            } else {
                // ì˜¤ë‹µ
                feedback.innerText = "âŒ";
                feedback.style.color = "#c62828";
                combo = 0; // ì½¤ë³´ ì´ˆê¸°í™”
                // 1.5ì´ˆ ë’¤ ë‹¤ìŒ ë¬¸ì œ (ì˜¤ë‹µ í™•ì¸ ì‹œê°„ ì¢€ ë” ì¤Œ)
                setTimeout(() => {
                    currentIndex++;
                    showQuestion();
                }, 1200);
            }
        }

        function handleTimeOut() {
            if (isAnswering) return;
            isAnswering = true;
            
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'flex';
            feedback.innerText = "â°"; // ì‹œê°„ ì´ˆê³¼ ì•„ì´ì½˜
            feedback.style.color = "#555";
            
            combo = 0;
            
            setTimeout(() => {
                currentIndex++;
                showQuestion();
            }, 1200);
        }

        function endGame() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = `${score}ì `;
            
            let msg = "";
            if(score >= 90) msg = "ì–´í¥! í˜¸ë‘ì´ ì„ ìƒë‹˜ì´ ê·¹ì°¬í•©ë‹ˆë‹¤! ğŸ¯ğŸ‘";
            else if(score >= 70) msg = "í›Œë¥­í•˜êµ°! ì•„ì£¼ ì˜í–ˆì–´! ğŸ¯âœ¨";
            else if(score >= 40) msg = "ìˆ˜ê³ í–ˆì–´! ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ë³´ì. ğŸ¯ğŸ“š";
            else msg = "ì •ì‹  ë°”ì§ ì°¨ë¦¬ê²Œ! ë‹¤ì‹œ í•´ë³´ì! ğŸ¯ğŸ”¥";
            
            document.getElementById('final-msg').innerText = msg;

            saveScore(userName, score, `${currentLevel}`);
        }

        function saveScore(name, score, mode) {
            let records = JSON.parse(localStorage.getItem('tigerGameRank')) || [];
            records.push({ name, score, mode, date: new Date().toLocaleDateString() });
            
            records.sort((a, b) => b.score - a.score); // ì ìˆ˜ ë†’ì€ ìˆœ
            
            localStorage.setItem('tigerGameRank', JSON.stringify(records));
        }

        function loadRanking() {
            const table = document.getElementById('ranking-table');
            if(!table) return;
            let records = JSON.parse(localStorage.getItem('tigerGameRank')) || [];
            
            let html = `<tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ëª¨ë“œ</th><th>ì ìˆ˜</th></tr>`;
            if (records.length === 0) {
                html += `<tr><td colspan="4" style="padding:20px; color:white;">ì•„ì§ ë„ì „ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            } else {
                records.slice(0, 5).forEach((r, index) => {
                    let badge = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : index + 1));
                    let rankClass = index < 3 ? `rank-${index+1}` : '';
                    html += `<tr class="${rankClass}">
                        <td>${badge}</td>
                        <td>${r.name}</td>
                        <td><small>${r.mode}</small></td>
                        <td style="font-weight:bold;">${r.score}ì </td>
                    </tr>`;
                });
            }
            table.innerHTML = html;
        }

        function goHome() {
            if(confirm("ê·¸ë§Œí•˜ê³  ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload();
        }
    </script>
</body>
</html>