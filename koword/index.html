<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>ì¥ë‚œê¾¸ëŸ¬ê¸° ì›ìˆ­ì´ì˜ ê¸€ì ì¡°ë¦½</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }

        body { 
            font-family: 'Jua', sans-serif; 
            background-color: #81c784; /* ì •ê¸€ ê·¸ë¦° */
            background-image: repeating-linear-gradient(45deg, #66bb6a 0, #66bb6a 20px, #81c784 20px, #81c784 40px);
            color: #333;
            text-align: center; 
            margin: 0; 
            padding: 0; 
            min-height: 100dvh; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-box { 
            background: #fffde7; /* ì—°í•œ ë°”ë‚˜ë‚˜ìƒ‰ */
            border-radius: 25px; 
            padding: 30px; 
            max-width: 800px; 
            width: 95%;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 #f57f17; /* ì§„í•œ ì˜¤ë Œì§€ ê·¸ë¦¼ì */
            border: 5px solid #fbc02d;
        }
        .hidden { display: none !important; }

        /* ì¸íŠ¸ë¡œ */
        .intro-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .char-img {
            width: 160px;
            height: 160px;
            object-fit: cover;
            border-radius: 50%;
            border: 6px solid #fbc02d;
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: swing 3s ease-in-out infinite;
        }
        @keyframes swing {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        h1 { 
            font-family: 'Jua', sans-serif; 
            color: #ef6c00; 
            font-size: 42px; 
            margin: 0;
            text-shadow: 2px 2px 0 #fff;
            line-height: 1.2;
        }
        
        .desc-text { font-size: 20px; color: #558b2f; margin-top: 5px; font-weight: bold;}

        /* ì…ë ¥ì°½ ë° ë²„íŠ¼ */
        input[type="text"] { 
            padding: 12px; 
            font-size: 22px; 
            border-radius: 15px; 
            border: 3px solid #fbc02d; 
            width: 70%; 
            font-family: 'Jua', sans-serif; 
            text-align: center; 
            margin-bottom: 20px; 
            background: #fff; 
            color: #333;
        }
        
        .btn { padding: 10px 15px; margin: 5px; font-size: 18px; cursor: pointer; border: none; border-radius: 12px; font-family: 'Jua', sans-serif; transition: 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        .lvl-btn { background: #dcedc8; color: #33691e; }
        .lvl-btn.active { background: #7cb342; color: white; border: 2px solid #33691e;}
        
        .diff-btn { background: #fff9c4; color: #f57f17; }
        .diff-btn.active { background: #ffca28; color: #e65100; border: 2px solid #e65100;}

        .start-btn { 
            background: #ef6c00; 
            color: white; 
            font-size: 32px; 
            padding: 15px 50px; 
            margin-top: 20px; 
            width: 80%; 
            border-radius: 50px;
            border-bottom: 6px solid #e65100;
        }

        /* â˜… ê²Œì„ í™”ë©´ */
        #game-screen {
            width: 100%;
            max-width: 600px;
            display: none;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
        }

        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            font-size: 22px;
            color: #fff;
            font-weight: bold;
            text-shadow: 1px 1px 2px #33691e;
        }

        .home-btn {
            background: #fff;
            color: #558b2f;
            border: 2px solid #7cb342;
            padding: 5px 12px;
            font-size: 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Jua', sans-serif;
            text-shadow: none;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }

        .quiz-area {
            background: #fff;
            border-radius: 20px;
            padding: 30px 20px;
            width: 95%;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .monkey-avatar {
            position: absolute;
            top: -50px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #fbc02d;
            background: #fff;
            object-fit: cover;
        }

        .quiz-mean {
            font-size: 24px;
            color: #333;
            margin-top: 40px; /* ì›ìˆ­ì´ ê³µê°„ */
            margin-bottom: 30px;
            word-break: keep-all;
            line-height: 1.4;
        }

        /* ì •ë‹µ ì¹¸ (ìœ„ìª½) */
        .answer-slots {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            min-height: 60px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .slot {
            width: 60px; height: 60px;
            border-bottom: 4px solid #bdbdbd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #1a237e;
            font-weight: bold;
            background: #f5f5f5;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
        }
        .slot.filled { border-bottom-color: #1a237e; background: #e8eaf6; }
        .slot.correct { background: #c8e6c9; border-bottom-color: #2e7d32; color: #2e7d32; }
        .slot.wrong { background: #ffcdd2; border-bottom-color: #c62828; color: #c62828; }

        /* ë³´ê¸° ë²„íŠ¼ (ì•„ë˜ìª½) */
        .scramble-pool {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .char-btn {
            width: 60px; height: 60px;
            background: #ffca28;
            color: #333;
            border: none;
            border-radius: 15px;
            font-size: 28px;
            font-family: 'Jua', sans-serif;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #f57f17;
            transition: transform 0.1s;
        }
        .char-btn:active { transform: translateY(4px); box-shadow: none; }
        .char-btn.used { 
            background: #e0e0e0; 
            color: #bdbdbd; 
            box-shadow: none; 
            transform: translateY(4px); 
            pointer-events: none; 
        }

        /* ëª…ì˜ˆì˜ ì „ë‹¹ */
        .rank-table { width: 100%; margin-top: 20px; border-collapse: separate; border-spacing: 0 5px; font-size: 18px; }
        .rank-table th { background: #558b2f; color: #fff; padding: 10px; border-radius: 10px 10px 0 0; }
        .rank-table td { background: #aed581; color: #1b5e20; padding: 10px; border-bottom: 1px solid #7cb342; font-weight: bold;}
        .rank-table tr:last-child td:first-child { border-bottom-left-radius: 10px; }
        .rank-table tr:last-child td:last-child { border-bottom-right-radius: 10px; }
        .rank-1 { color: #ff6f00 !important; font-size: 1.2em; text-shadow: 1px 1px 0 #fff;}

        /* ê²°ê³¼ í™”ë©´ */
        #result-screen h1 { color: #2e7d32; }
        #final-record { color: #e65100; font-size: 40px; }

        @media (max-width: 600px) {
            h1 { font-size: 32px; }
            .char-img { width: 130px; height: 130px; }
            .game-box { padding: 20px; }
            
            .slot { width: 45px; height: 45px; font-size: 24px; }
            .char-btn { width: 50px; height: 50px; font-size: 24px; }
            .quiz-mean { font-size: 20px; }
        }
    </style>
</head>
<body>

    <div id="intro-screen" class="game-box">
        <div class="intro-header">
            <img src="monkey.png" alt="ì¥ë‚œê¾¸ëŸ¬ê¸° ì›ìˆ­ì´" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Monkey%20Face.png'">
            <div>
                <h1>ì¥ë‚œê¾¸ëŸ¬ê¸° ì›ìˆ­ì´ì˜<br>ê¸€ì ì¡°ë¦½</h1>
                <p class="desc-text">ë’¤ì£½ë°•ì£½ ì„ì¸ ê¸€ìë¥¼ ë§ì¶°ì£¼ì„¸ìš”!</p>
            </div>
        </div>

        <input type="text" id="username" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="8">

        <div style="margin: 20px 0;">
            <p style="margin-bottom:5px;">ğŸ“š í•™ë…„ ì„ íƒ</p>
            <button class="btn lvl-btn active" onclick="selectLevel('1-2', this)">1-2í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('3-4', this)">3-4í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('5-6', this)">5-6í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('ì¤‘1', this)">ì¤‘1</button>
        </div>

        <div style="margin: 20px 0;">
            <p style="margin-bottom:5px;">ğŸŒ ë¬¸ì œ ìˆ˜ ì„ íƒ</p>
            <button class="btn diff-btn active" onclick="selectCount(5, this)">5ë¬¸ì œ</button>
            <button class="btn diff-btn" onclick="selectCount(10, this)">10ë¬¸ì œ</button>
            <button class="btn diff-btn" onclick="selectCount(15, this)">15ë¬¸ì œ</button>
        </div>

        <button class="btn start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘ â–¶</button>

        <div style="margin-top: 30px;">
            <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (ë¹ ë¥¸ ìˆœ)</h3>
            <table class="rank-table" id="ranking-table"><tr><td colspan="4">ë¡œë”©ì¤‘...</td></tr></table>
        </div>
    </div>

    <div id="game-screen">
        <div class="top-bar">
            <span>ğŸŒ <span id="progress-display">1 / 5</span></span>
            <button class="home-btn" onclick="goHome()">ğŸ  ë‚˜ê°€ê¸°</button>
            <span>â±ï¸ <span id="timer-display">0</span>ì´ˆ</span>
        </div>

        <div class="quiz-area">
            <img src="monkey.png" class="monkey-avatar" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Monkey%20Face.png'">
            <div id="quiz-mean" class="quiz-mean">ë¬¸ì œ ì„¤ëª…ì´ ë‚˜ì˜µë‹ˆë‹¤...</div>
            
            <div id="answer-slots" class="answer-slots"></div>
            
            <div id="scramble-pool" class="scramble-pool"></div>
        </div>
        
        <div style="margin-top:20px; color:#fff; font-size:18px;">* ë…¸ë€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸€ìë¥¼ ë„£ìœ¼ì„¸ìš”.</div>
    </div>

    <div id="result-screen" class="game-box hidden">
        <img src="monkey.png" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Monkey%20Face.png'">
        <h1 style="margin-top:20px;">ëª¨ë‘ ë§ì·„ì–´ìš”!</h1>
        <h2 id="final-record" style="margin: 15px 0;">ê±¸ë¦° ì‹œê°„: 0ì´ˆ</h2>
        <p style="font-size: 22px; color:#555;">ì›ìˆ­ì´ê°€ ê°íƒ„í–ˆì–´ìš”! "ìš°ë¼ë¼!"</p>
        <button class="btn start-btn" style="background:#7cb342; border-bottom:5px solid #558b2f;" onclick="location.reload()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
    </div>

    <script src="../kovocab/my_word_data.js"></script> 

    <script>
        if (typeof wordData === 'undefined') {
            alert("ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! (../kovocab/my_word_data.js í™•ì¸)");
            var wordData = { "1-2": [{word:"ì‚¬ê³¼",mean:"ê³¼ì¼"},{word:"ë°”ë‚˜ë‚˜",mean:"ë…¸ë€ ê³¼ì¼"}] };
        }

        let currentLevel = "1-2";
        let targetCount = 5;
        let userName = "";
        let quizList = [];
        let currentIndex = 0;
        let startTime;
        let timerInterval;
        
        // í˜„ì¬ ë¬¸ì œ ìƒíƒœ
        let currentWord = "";
        let currentAnswer = []; // ì‚¬ìš©ìê°€ ì…ë ¥ ì¤‘ì¸ ê¸€ìë“¤
        
        window.onload = loadRanking;

        function selectLevel(lvl, btn) {
            currentLevel = lvl;
            document.querySelectorAll('.lvl-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function selectCount(count, btn) {
            targetCount = count;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function startGame() {
            const inputName = document.getElementById('username').value.trim();
            if (!inputName) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            userName = inputName;

            const pool = wordData[currentLevel];
            if (!pool || pool.length < targetCount) {
                alert(`ë‹¨ì–´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ìµœì†Œ ${targetCount}ê°œ í•„ìš”)`); return;
            }

            quizList = [...pool].sort(() => 0.5 - Math.random()).slice(0, targetCount);
            
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').style.display = 'flex';

            currentIndex = 0;
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            
            showQuestion();
        }

        function updateTimer() {
            const sec = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('timer-display').innerText = sec;
        }

        function showQuestion() {
            if (currentIndex >= quizList.length) {
                endGame();
                return;
            }

            const q = quizList[currentIndex];
            currentWord = q.word.replace(/\s/g, ''); // ê³µë°± ì œê±°
            currentAnswer = new Array(currentWord.length).fill(null);
            
            document.getElementById('progress-display').innerText = `${currentIndex + 1} / ${targetCount}`;
            document.getElementById('quiz-mean').innerText = q.mean;
            
            renderSlots();
            renderButtons(currentWord);
        }

        function renderSlots() {
            const container = document.getElementById('answer-slots');
            container.innerHTML = '';
            
            currentAnswer.forEach((char, index) => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                if(char) {
                    slot.innerText = char.val;
                    slot.classList.add('filled');
                    // ìŠ¬ë¡¯ í´ë¦­ ì‹œ ì·¨ì†Œ ê¸°ëŠ¥
                    slot.onclick = () => removeChar(index);
                }
                container.appendChild(slot);
            });
        }

        function renderButtons(word) {
            const container = document.getElementById('scramble-pool');
            // ì²˜ìŒ ë Œë”ë§í•  ë•Œë§Œ ì„ê³ , ì´í›„ì—ëŠ” ìƒíƒœ ìœ ì§€
            if(container.innerHTML === '') {
                let chars = word.split('').map((c, i) => ({val: c, id: i}));
                chars.sort(() => 0.5 - Math.random()); // ê¸€ì ì„ê¸°
                
                chars.forEach(c => {
                    const btn = document.createElement('button');
                    btn.className = 'char-btn';
                    btn.innerText = c.val;
                    btn.id = `btn-${c.id}`;
                    btn.onclick = () => addChar(c);
                    container.appendChild(btn);
                });
            }
        }

        function addChar(charObj) {
            // ë¹ˆ ì¹¸ ì°¾ê¸°
            const emptyIdx = currentAnswer.findIndex(c => c === null);
            if (emptyIdx === -1) return; // ê½‰ ì°¼ìœ¼ë©´ ë¬´ì‹œ

            currentAnswer[emptyIdx] = charObj;
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById(`btn-${charObj.id}`).classList.add('used');
            
            renderSlots();
            checkAnswer();
        }

        function removeChar(index) {
            const charObj = currentAnswer[index];
            if (!charObj) return;

            currentAnswer[index] = null;
            
            // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
            document.getElementById(`btn-${charObj.id}`).classList.remove('used');
            
            // ì¤‘ê°„ì— êµ¬ë©ë‚˜ë©´ ì•ìœ¼ë¡œ ë‹¹ê¸°ê¸°? (ì„ íƒì‚¬í•­, ì§€ê¸ˆì€ ê·¸ëƒ¥ ë‘ )
            // ì‚¬ìš©ì í¸ì˜ë¥¼ ìœ„í•´ ë‹¹ê¸°ëŠ”ê²Œ ì¢‹ìŒ
            currentAnswer = currentAnswer.filter(c => c !== null);
            while(currentAnswer.length < currentWord.length) currentAnswer.push(null);

            renderSlots();
        }

        function checkAnswer() {
            // ë‹¤ ì±„ì›Œì¡ŒëŠ”ì§€ í™•ì¸
            if (currentAnswer.includes(null)) return;

            const userWord = currentAnswer.map(c => c.val).join('');
            
            if (userWord === currentWord) {
                // ì •ë‹µ!
                const slots = document.querySelectorAll('.slot');
                slots.forEach(s => s.classList.add('correct'));
                
                setTimeout(() => {
                    document.getElementById('scramble-pool').innerHTML = ''; // ë²„íŠ¼ ì´ˆê¸°í™”
                    currentIndex++;
                    showQuestion();
                }, 1000); // 1ì´ˆ ë’¤ ë‹¤ìŒ ë¬¸ì œ
            } else {
                // ì˜¤ë‹µ!
                const slots = document.querySelectorAll('.slot');
                slots.forEach(s => s.classList.add('wrong'));
                
                setTimeout(() => {
                    // ì „ì²´ ë¦¬ì…‹ (ë‹¤ì‹œ í’€ê²Œ)
                    currentAnswer = new Array(currentWord.length).fill(null);
                    renderSlots();
                    // ëª¨ë“  ë²„íŠ¼ í™œì„±í™”
                    document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('used'));
                }, 500);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').classList.remove('hidden');
            
            document.getElementById('final-record').innerText = `ê±¸ë¦° ì‹œê°„: ${timeTaken}ì´ˆ`;

            saveScore(userName, timeTaken, `${currentLevel} (${targetCount}ë¬¸ì œ)`);
        }

        function saveScore(name, time, mode) {
            let records = JSON.parse(localStorage.getItem('monkeyGameRank')) || [];
            records.push({ name, time, mode, date: new Date().toLocaleDateString() });
            
            records.sort((a, b) => a.time - b.time); // ì‹œê°„ ë¹ ë¥¸ ìˆœ
            
            localStorage.setItem('monkeyGameRank', JSON.stringify(records));
        }

        function loadRanking() {
            const table = document.getElementById('ranking-table');
            if(!table) return;
            let records = JSON.parse(localStorage.getItem('monkeyGameRank')) || [];
            
            let html = `<tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ë‚´ìš©</th><th>ì‹œê°„</th></tr>`;
            if (records.length === 0) {
                html += `<tr><td colspan="4" style="padding:20px; color:#333;">ì•„ì§ ë„ì „ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            } else {
                records.slice(0, 5).forEach((r, index) => {
                    let badge = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : index + 1));
                    let rankClass = index < 3 ? `rank-${index+1}` : '';
                    html += `<tr class="${rankClass}">
                        <td>${badge}</td>
                        <td>${r.name}</td>
                        <td><small>${r.mode}</small></td>
                        <td style="font-weight:bold;">${r.time}ì´ˆ</td>
                    </tr>`;
                });
            }
            table.innerHTML = html;
        }

        function goHome() {
            if(confirm("ê·¸ë§Œí•˜ê³  ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload();
        }
    </script>
</body>
</html>