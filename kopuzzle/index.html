<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>ë‚˜ë¬´ëŠ˜ë³´ í• ì•„ë²„ì§€ì˜ ì‹­ìí’€ì´</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu&family=Jua&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }

        body { 
            font-family: 'Jua', sans-serif; 
            background-color: #f6e8c3; 
            background-image: radial-gradient(#d7ccc8 1px, transparent 1px);
            background-size: 20px 20px;
            color: #4e342e; 
            text-align: center; 
            margin: 0; 
            padding: 0; 
            min-height: 100dvh; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-box { 
            background: #fff8e1; 
            border-radius: 20px; 
            padding: 30px; 
            max-width: 900px; 
            width: 95%;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 #8d6e63; 
            border: 4px solid #5d4037;
        }
        .hidden { display: none !important; }

        .intro-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .char-img {
            width: 180px; 
            height: 180px;
            object-fit: cover;
            border-radius: 50%;
            border: 6px solid #8d6e63;
            background: #fff;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        h1 { 
            font-family: 'Jua', sans-serif; 
            color: #5d4037; 
            font-size: 48px; 
            margin: 0;
            line-height: 1.2;
            text-shadow: 2px 2px 0 #efebe9;
        }
        
        .desc-text { font-size: 24px; color: #795548; margin-top: 5px; }

        input[type="text"] { 
            padding: 15px; 
            font-size: 24px; 
            border-radius: 12px; 
            border: 3px solid #8d6e63; 
            width: 60%; 
            font-family: 'Jua', sans-serif; 
            text-align: center; 
            margin-bottom: 20px; 
            background: #efebe9; 
        }
        
        .btn { padding: 12px 20px; margin: 8px; font-size: 20px; cursor: pointer; border: none; border-radius: 10px; font-family: 'Jua', sans-serif; transition: 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        /* ë²„íŠ¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒ: active ìƒíƒœì—ì„œ í°ìƒ‰(#fff) ì‚¬ìš© ì¤‘ */
        .lvl-btn { background: #d7ccc8; color: #5d4037; }
        .lvl-btn.active { background: #8d6e63; color: white; border: 2px solid #3e2723;}
        
        .diff-btn { background: #ffe0b2; color: #5d4037; }
        .diff-btn.active { background: #ff9800; color: white; border: 2px solid #e65100;}

        .start-btn { 
            background: #6d4c41; 
            color: white; 
            font-size: 32px; 
            padding: 15px 50px; 
            margin-top: 20px; 
            width: 80%; 
            border-bottom: 5px solid #3e2723;
        }

        #game-screen {
            width: 100%;
            max-width: 800px; 
            display: none;
            flex-direction: column;
            align-items: center;
            padding-bottom: 180px; 
        }

        .hud {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: bold;
            color: #5d4037;
            background: #fff3e0;
            border-bottom: 3px solid #d7ccc8;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .crossword-container {
            margin-top: 30px;
            padding: 20px;
            background: #8d6e63;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            overflow: auto;
            max-width: 100%;
            display: flex; justify-content: center; 
        }

        table { border-collapse: collapse; background: #3e2723; margin: 0 auto; }
        
        td {
            width: 60px; height: 60px; 
            border: 2px solid #5d4037; 
            text-align: center;
            font-size: 30px; 
            background: #3e2723; 
            color: transparent;
            cursor: default;
            position: relative;
        }

        td.letter-cell {
            background: #fff8e1;
            color: transparent; 
            font-weight: bold;
            cursor: pointer;
        }
        
        td.active-word { background: #fff59d; }
        td.active-cell { background: #ffcc80; }
        
        td.solved {
            color: #3e2723; 
            background: #c8e6c9; 
        }

        .cell-num {
            position: absolute;
            top: 2px; left: 3px;
            font-size: 14px; 
            color: #8d6e63;
            line-height: 1;
            font-weight: bold;
        }

        .input-area {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #fff;
            border-top: 6px solid #8d6e63;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .clue-label { font-size: 18px; color: #8d6e63; margin-bottom: 5px; }
        
        .clue-text {
            font-size: 26px; 
            margin-bottom: 15px;
            color: #5d4037;
            word-break: keep-all;
            min-height: 50px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold;
            text-align: center;
            width: 100%;
        }

        .answer-input-group {
            display: flex;
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }

        .answer-input {
            flex: 1;
            padding: 15px;
            font-size: 24px;
            border: 4px solid #8d6e63;
            border-radius: 15px;
            text-align: center;
            font-family: 'Jua', sans-serif;
            margin-bottom: 0; 
        }

        .submit-btn {
            background: #8d6e63;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 0 30px;
            font-size: 22px;
            font-family: 'Jua', sans-serif;
            cursor: pointer;
        }

        .shake { animation: shake 0.4s; border-color: #e53935; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* â˜… ëª…ì˜ˆì˜ ì „ë‹¹ í…Œì´ë¸” ìŠ¤íƒ€ì¼ ìˆ˜ì • (ì˜ ë³´ì´ê²Œ!) */
        .rank-table { width: 100%; margin-top: 20px; border-collapse: separate; border-spacing: 0 5px; font-size: 20px; }
        
        .rank-table th { 
            background: #5d4037; /* í—¤ë” ì§„í•œ ê°ˆìƒ‰ */
            color: #fff8e1;      /* í—¤ë” ê¸€ì”¨ ë°ì€ìƒ‰ */
            padding: 12px; 
            border-radius: 10px 10px 0 0;
        }
        
        .rank-table td { 
            background: #8d6e63; /* ë‚´ìš© ë°°ê²½: ì§„í•œ ë‚˜ë¬´ìƒ‰ (ë²„íŠ¼ê³¼ ìœ ì‚¬) */
            color: white;        /* â˜… ê¸€ì”¨: í•˜ì–€ìƒ‰ (ì˜ ë³´ì´ê²Œ!) */
            padding: 12px; 
            border-bottom: 1px solid #795548;
        }
        
        /* í…Œì´ë¸” ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ ì²˜ë¦¬ */
        .rank-table tr:last-child td:first-child { border-bottom-left-radius: 10px; }
        .rank-table tr:last-child td:last-child { border-bottom-right-radius: 10px; }

        /* 1,2,3ë“± ìƒ‰ìƒ ë³€ê²½ (ì–´ë‘ìš´ ë°°ê²½ì—ì„œë„ ì˜ ë³´ì´ê²Œ) */
        .rank-1 { color: #ffd54f !important; font-weight: bold; text-shadow: 1px 1px 0 #3e2723; } /* ê¸ˆìƒ‰ */
        .rank-2 { color: #cfd8dc !important; font-weight: bold; } /* ì€ìƒ‰ */
        .rank-3 { color: #ffccbc !important; font-weight: bold; } /* ë™ìƒ‰ */

        @media (max-width: 600px) {
            .intro-header { flex-direction: column; gap: 10px; }
            h1 { font-size: 32px; }
            .char-img { width: 120px; height: 120px; }
            
            td { width: 36px; height: 36px; font-size: 18px; border-width: 1px; } 
            .cell-num { font-size: 10px; top: 1px; left: 1px; }
            
            .game-box { padding: 20px; }
            .input-area { padding: 15px; }
            .clue-text { font-size: 18px; min-height: 40px; }
            .answer-input { padding: 10px; font-size: 20px; border-width: 3px; }
            .submit-btn { padding: 0 20px; font-size: 18px; }
            .hud { padding: 10px 15px; font-size: 18px; }
        }
    </style>
</head>
<body>

    <div id="intro-screen" class="game-box">
        <div class="intro-header">
            <img src="sloth.png" alt="ë‚˜ë¬´ëŠ˜ë³´ í• ì•„ë²„ì§€" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Sloth.png'">
            <div>
                <h1>ë‚˜ë¬´ëŠ˜ë³´ í• ì•„ë²„ì§€ì˜<br>ì‹­ìí’€ì´</h1>
                <p class="desc-text">ì²œì²œíˆ.. ë‹¨ì–´ë¥¼ ì´ì–´ë³´ê²Œë‚˜..</p>
            </div>
        </div>

        <input type="text" id="username" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="8">

        <div style="margin: 20px 0;">
            <p style="margin-bottom:5px;">ğŸ“š í•™ë…„ ì„ íƒ</p>
            <button class="btn lvl-btn active" onclick="selectLevel('1-2', this)">1-2í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('3-4', this)">3-4í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('5-6', this)">5-6í•™ë…„</button>
            <button class="btn lvl-btn" onclick="selectLevel('ì¤‘1', this)">ì¤‘1</button>
        </div>

        <div style="margin: 20px 0;">
            <p style="margin-bottom:5px;">ğŸ§© ë‚œì´ë„</p>
            <button class="btn diff-btn active" onclick="selectDifficulty(5, this)">ì‰¬ì›€</button>
            <button class="btn diff-btn" onclick="selectDifficulty(8, this)">ë³´í†µ</button>
            <button class="btn diff-btn" onclick="selectDifficulty(12, this)">ì–´ë ¤ì›€</button>
            <button class="btn diff-btn" onclick="selectDifficulty(15, this)">ì§€ì˜¥</button>
        </div>

        <button class="btn start-btn" onclick="startGame()">í¼ì¦ ì‹œì‘ â–¶</button>

        <div style="margin-top: 30px; border-top: 2px dashed #bcaaa4; padding-top:15px;">
            <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (ì™„ë£Œ ì‹œê°„)</h3>
            <table class="rank-table" id="ranking-table"><tr><td colspan="4" style="color:white;">ë¡œë”©ì¤‘...</td></tr></table>
        </div>
    </div>

    <div id="game-screen">
        <div class="hud">
            <span>â±ï¸ <span id="timer-display">0</span>ì´ˆ</span>
            <button class="btn" style="background:#fff; color:#5d4037; font-size:16px; padding:8px 15px; margin:0;" onclick="goHome()">ğŸ  ë‚˜ê°€ê¸°</button>
        </div>

        <div class="crossword-container">
            <table id="crossword-grid"></table>
        </div>
        <div style="color:#795548; font-size:16px; margin-top:15px;">* ë…¸ë€ìƒ‰ ì¹¸ì„ ëˆ„ë¥´ê³  ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”.</div>

        <div class="input-area">
            <div class="clue-label" id="clue-label">ì„¤ëª…</div>
            <div class="clue-text" id="clue-display">í¼ì¦ ì¹¸ì„ ëˆŒëŸ¬ë³´ê²Œë‚˜...</div>
            <div class="answer-input-group" id="input-group" style="visibility: hidden;">
                <input type="text" id="user-answer" class="answer-input" placeholder="ì •ë‹µ ì…ë ¥" onkeypress="handleEnter(event)">
                <button class="submit-btn" onclick="checkAnswer()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="game-box hidden">
        <img src="sloth.png" class="char-img" onerror="this.src='https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Sloth.png'">
        <h1 style="color:#2e7d32; margin-top:15px;">í¼ì¦ ì™„ì„±!</h1>
        <h2 id="final-record" style="color: #e65100; font-size: 32px; margin: 10px 0;">ê¸°ë¡: 0ì´ˆ</h2>
        <p style="font-size: 20px;">í—ˆí—ˆ.. ì œë²•ì´êµ¬ë§Œ! ì°¸ ì˜í–ˆì–´.</p>
        <button class="btn start-btn" style="background:#8d6e63;" onclick="location.reload()">ğŸ”„ ë‹¤ë¥¸ í¼ì¦ í’€ê¸°</button>
    </div>

    <script src="../kovocab/my_word_data.js"></script> 

    <script>
        if (typeof wordData === 'undefined') {
            alert("ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! (../kovocab/my_word_data.js í™•ì¸)");
            var wordData = { "1-2": [{word:"ì‚¬ê³¼",mean:"ê³¼ì¼"},{word:"ê³¼ì¼",mean:"ì‚¬ê³¼ ë“±"}] };
        }

        let currentLevel = "1-2";
        let targetWordCount = 5; 
        let userName = "";
        let startTime;
        let timerInterval;
        let activeWordInfo = null; 
        
        const gridSize = 20; 
        let grid = []; 
        let placedWords = []; 

        window.onload = loadRanking;

        function selectLevel(lvl, btn) {
            currentLevel = lvl;
            document.querySelectorAll('.lvl-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function selectDifficulty(count, btn) {
            targetWordCount = count;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function startGame() {
            const inputName = document.getElementById('username').value.trim();
            if (!inputName) { alert("ì´ë¦„ì„ ì ì–´ì£¼ê²Œë‚˜..."); return; }
            userName = inputName;

            const pool = wordData[currentLevel];
            if (!pool || pool.length < targetWordCount) {
                alert("ë‹¨ì–´ê°€ ë¶€ì¡±í•˜êµ¬ë§Œ.. ë‹¤ë¥¸ í•™ë…„ì„ ê³¨ë¼ë³´ê²Œ."); return;
            }

            if (!generateCrossword(pool, targetWordCount)) {
                alert("í¼ì¦ì„ ë§Œë“¤ê¸°ê°€ ì–´ë µêµ¬ë§Œ. ë‹¤ì‹œ ì‹œë„í•´ë³´ê²Œë‚˜!"); return;
            }

            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').style.display = 'flex';

            renderGrid();
            startTimer();
        }

        function generateCrossword(pool, maxWords) {
            grid = Array.from({ length: gridSize }, () => Array(gridSize).fill(null));
            placedWords = [];
            let wordsToPlace = [...pool].sort(() => 0.5 - Math.random()); 

            let first = wordsToPlace.pop();
            let center = Math.floor(gridSize / 2);
            let startCol = center - Math.floor(first.word.length / 2);
            placeWordOnGrid(first, center, startCol, 'across');

            let attempts = 0;
            while (placedWords.length < maxWords && attempts < 1000 && wordsToPlace.length > 0) {
                attempts++;
                let candidate = wordsToPlace[0]; 
                let placed = false;

                for (let pw of placedWords) {
                    if (placed) break;
                    
                    for (let i = 0; i < candidate.word.length; i++) {
                        let char = candidate.word[i];
                        for (let j = 0; j < pw.word.length; j++) {
                            if (pw.word[j] === char) {
                                let newDir = (pw.direction === 'across') ? 'down' : 'across';
                                let newRow, newCol;

                                if (newDir === 'down') {
                                    newRow = pw.row - i;
                                    newCol = pw.col + j;
                                } else { 
                                    newRow = pw.row + j;
                                    newCol = pw.col - i;
                                }

                                if (canPlaceWord(candidate.word, newRow, newCol, newDir)) {
                                    placeWordOnGrid(candidate, newRow, newCol, newDir);
                                    wordsToPlace.shift(); 
                                    placed = true;
                                    break;
                                }
                            }
                        }
                        if (placed) break;
                    }
                }
                
                if (!placed) {
                    wordsToPlace.push(wordsToPlace.shift());
                    if (attempts > 500) wordsToPlace.shift(); 
                }
            }

            placedWords.sort((a, b) => (a.row - b.row) || (a.col - b.col));
            placedWords.forEach((w, idx) => w.number = idx + 1);

            return placedWords.length >= 3; 
        }

        function canPlaceWord(word, row, col, dir) {
            if (row < 0 || col < 0 || row >= gridSize || col >= gridSize) return false;
            if (dir === 'across' && col + word.length > gridSize) return false;
            if (dir === 'down' && row + word.length > gridSize) return false;

            for (let i = 0; i < word.length; i++) {
                let r = row + (dir === 'down' ? i : 0);
                let c = col + (dir === 'across' ? i : 0);
                
                if (grid[r][c] !== null && grid[r][c] !== word[i]) return false;

                if (grid[r][c] === null) {
                    let neighbors = 0;
                    if (r>0 && grid[r-1][c]) neighbors++;
                    if (r<gridSize-1 && grid[r+1][c]) neighbors++;
                    if (c>0 && grid[r][c-1]) neighbors++;
                    if (c<gridSize-1 && grid[r][c+1]) neighbors++;
                }
            }
            return true;
        }

        function placeWordOnGrid(wordObj, row, col, dir) {
            placedWords.push({
                ...wordObj, row, col, direction: dir, solved: false
            });
            for (let i = 0; i < wordObj.word.length; i++) {
                let r = row + (dir === 'down' ? i : 0);
                let c = col + (dir === 'across' ? i : 0);
                grid[r][c] = wordObj.word[i];
            }
        }

        function renderGrid() {
            const table = document.getElementById('crossword-grid');
            table.innerHTML = '';

            let minR=gridSize, maxR=0, minC=gridSize, maxC=0;
            placedWords.forEach(w => {
                minR = Math.min(minR, w.row);
                maxR = Math.max(maxR, w.row + (w.direction==='down' ? w.word.length : 1));
                minC = Math.min(minC, w.col);
                maxC = Math.max(maxC, w.col + (w.direction==='across' ? w.word.length : 1));
            });
            minR = Math.max(0, minR-1); maxR = Math.min(gridSize, maxR+1);
            minC = Math.max(0, minC-1); maxC = Math.min(gridSize, maxC+1);

            for(let r=minR; r<maxR; r++) {
                let tr = document.createElement('tr');
                for(let c=minC; c<maxC; c++) {
                    let td = document.createElement('td');
                    if (grid[r][c]) {
                        td.className = 'letter-cell';
                        td.dataset.row = r;
                        td.dataset.col = c;
                        td.onclick = () => onCellClick(r, c);
                        
                        let wordStarts = placedWords.filter(w => w.row === r && w.col === c);
                        if(wordStarts.length > 0) {
                            let numSpan = document.createElement('span');
                            numSpan.className = 'cell-num';
                            numSpan.innerText = wordStarts.map(w=>w.number).join(',');
                            td.appendChild(numSpan);
                        }
                        
                        let solvedSpan = document.createElement('span');
                        solvedSpan.className = 'letter-content';
                        solvedSpan.innerText = grid[r][c]; 
                        td.appendChild(solvedSpan);
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
        }

        function onCellClick(r, c) {
            let candidates = placedWords.filter(w => {
                if (w.direction === 'across') return w.row === r && c >= w.col && c < w.col + w.word.length;
                else return w.col === c && r >= w.row && r < w.row + w.word.length;
            });

            if (candidates.length === 0) return;

            let selected = candidates[0];
            if (activeWordInfo && candidates.length > 1) {
                if (activeWordInfo.word === candidates[0].word) selected = candidates[1];
            }

            activeWordInfo = selected;
            highlightWord(selected);
            showInput(selected);
        }

        function highlightWord(wordObj) {
            document.querySelectorAll('td').forEach(td => {
                td.classList.remove('active-word');
                td.classList.remove('active-cell');
            });

            for(let i=0; i<wordObj.word.length; i++) {
                let r = wordObj.row + (wordObj.direction === 'down' ? i : 0);
                let c = wordObj.col + (wordObj.direction === 'across' ? i : 0);
                let td = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
                if(td) td.classList.add('active-word');
            }
        }

        function showInput(wordObj) {
            document.getElementById('input-group').style.visibility = 'visible';
            document.getElementById('clue-label').innerText = `ê°€ë¡œ/ì„¸ë¡œ ${wordObj.number}ë²ˆ ë¬¸ì œ (${wordObj.word.length}ê¸€ì)`;
            document.getElementById('clue-display').innerText = wordObj.mean;
            
            const input = document.getElementById('user-answer');
            input.value = '';
            input.placeholder = `${wordObj.word.length}ê¸€ì ì •ë‹µ ì…ë ¥`;
            input.focus();
        }

        function handleEnter(e) {
            if(e.key === 'Enter') checkAnswer();
        }

        function checkAnswer() {
            if (!activeWordInfo) return;
            const input = document.getElementById('user-answer');
            const userVal = input.value.trim();

            if (userVal === activeWordInfo.word) {
                activeWordInfo.solved = true;
                revealWord(activeWordInfo);
                input.value = '';
                document.getElementById('input-group').style.visibility = 'hidden';
                document.getElementById('clue-display').innerText = "ì°¸ ì˜í–ˆêµ¬ë§Œ! ë‹¤ìŒ ì¹¸ì„ ëˆŒëŸ¬ë³´ê²Œ.";
                activeWordInfo = null;
                checkGameClear();
            } else {
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 400);
                
                alert(`í—ˆí—ˆ.. í‹€ë ¸êµ¬ë§Œ. íŒíŠ¸ í•œ ê¸€ì ì¤Œì„¸.`);
                giveHint(activeWordInfo);
                
                input.value = '';
                input.focus();
            }
        }

        function giveHint(wordObj) {
            let unsolvedIndices = [];
            for(let i=0; i<wordObj.word.length; i++) {
                let r = wordObj.row + (wordObj.direction === 'down' ? i : 0);
                let c = wordObj.col + (wordObj.direction === 'across' ? i : 0);
                let td = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
                if(td && !td.classList.contains('solved')) {
                    unsolvedIndices.push({r, c});
                }
            }

            if (unsolvedIndices.length > 0) {
                let target = unsolvedIndices[Math.floor(Math.random() * unsolvedIndices.length)];
                let td = document.querySelector(`td[data-row="${target.r}"][data-col="${target.c}"]`);
                if(td) td.classList.add('solved');
                
                let allRevealed = true;
                for(let i=0; i<wordObj.word.length; i++) {
                    let r = wordObj.row + (wordObj.direction === 'down' ? i : 0);
                    let c = wordObj.col + (wordObj.direction === 'across' ? i : 0);
                    let cell = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
                    if(!cell || !cell.classList.contains('solved')) {
                        allRevealed = false;
                        break;
                    }
                }

                if(allRevealed) {
                    wordObj.solved = true;
                    document.getElementById('input-group').style.visibility = 'hidden';
                    document.getElementById('clue-display').innerText = "í—ˆí—ˆ, íŒíŠ¸ë¡œ ë‹¤ í’€ì—ˆêµ¬ë§Œ! ì •ë‹µì¼ì„¸.";
                    activeWordInfo = null;
                    checkGameClear(); 
                }
            }
        }

        function revealWord(wordObj) {
            for(let i=0; i<wordObj.word.length; i++) {
                let r = wordObj.row + (wordObj.direction === 'down' ? i : 0);
                let c = wordObj.col + (wordObj.direction === 'across' ? i : 0);
                let td = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
                if(td) td.classList.add('solved');
            }
        }

        function checkGameClear() {
            if (placedWords.every(w => w.solved)) {
                endGame();
            }
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                let sec = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timer-display').innerText = sec;
            }, 1000);
        }

        function endGame() {
            clearInterval(timerInterval);
            let finalTime = Math.floor((Date.now() - startTime) / 1000);
            
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-record').innerText = `ê±¸ë¦° ì‹œê°„: ${finalTime}ì´ˆ`;

            saveScore(userName, finalTime, `${currentLevel} (${targetWordCount}ê°œ)`);
        }

        function saveScore(name, time, mode) {
            let records = JSON.parse(localStorage.getItem('slothGameRank')) || [];
            records.push({ name: name, time: time, mode: mode, date: new Date().toLocaleDateString() });
            records.sort((a, b) => a.time - b.time); 
            localStorage.setItem('slothGameRank', JSON.stringify(records));
        }

        function loadRanking() {
            const table = document.getElementById('ranking-table');
            if(!table) return;
            let records = JSON.parse(localStorage.getItem('slothGameRank')) || [];
            
            let html = `<tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ëª¨ë“œ</th><th>ì‹œê°„</th></tr>`;
            if (records.length === 0) {
                html += `<tr><td colspan="4" style="padding:20px; color:white;">ì•„ì§ ê¸°ë¡ì´ ì—†êµ¬ë§Œ.. ìë„¤ê°€ 1ë“± í•´ë³´ê²Œ.</td></tr>`;
            } else {
                records.slice(0, 5).forEach((r, index) => {
                    let badge = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : index + 1));
                    let rankClass = index < 3 ? `rank-${index+1}` : '';
                    html += `<tr><td class="${rankClass}">${badge}</td><td>${r.name}</td><td><small>${r.mode}</small></td><td>${r.time}ì´ˆ</td></tr>`;
                });
            }
            table.innerHTML = html;
        }

        function goHome() {
            if(confirm("ê·¸ë§Œí•˜ê³  ë‚˜ê°€ì‹œê² ë‚˜? ê¸°ë¡ì€ ì €ì¥ ì•ˆ ëœë‹¤ë„¤.")) location.reload();
        }
    </script>
</body>
</html>